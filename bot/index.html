<!DOCTYPE html>
<html>
<head><meta charset="utf-8"/></head>
<body>
  <div id="log">Session startingâ€¦</div>
  <input id="in"/><button id="btn">Send</button>
  <script>
    const deploymentId = 'd7a4ab4b-5374-48dc-abff-20e94d283345';
    const region       = 'mypurecloud.jp';
    const socket       = new WebSocket(
      `wss://webmessaging.${region}/v1?deploymentId=${deploymentId}`
    );
    let convId, partId;
    const logEl = document.getElementById('log');
    const log = (who, txt) => {
      const d = document.createElement('div');
      d.textContent = (who==='you'?'You: ':'Agent: ') + txt;
      logEl.appendChild(d);
    };
    socket.onopen = () => socket.send(JSON.stringify({
      action:'configureSession', deploymentId, tracingId:crypto.randomUUID()
    }));
    socket.onmessage = ({data}) => {
      const m = JSON.parse(data);
      if (m.action==='configureSessionResponse') {
        convId=m.body.conversationId; partId=m.body.participantId;
        log('agent','Session configured. Say hi!');
      }
      if (m.type==='message'&&m.body?.text) log('agent',m.body.text);
    };
    document.getElementById('btn').onclick = () => {
      const txt = document.getElementById('in').value.trim();
      if (!convId||!txt) return;
      socket.send(JSON.stringify({
        action:'onMessage', conversationId:convId,
        participantId:partId,
        body:{text:txt}, contentType:'text/plain'
      }));
      log('you',txt);
      document.getElementById('in').value='';
    };
  </script>
</body>
</html>
